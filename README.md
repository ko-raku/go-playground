# Goを使用して他のAPIを呼び出し
* APIは「[OpenWeatherMap](https://openweathermap.org/price#weather)」を使用

## weather(app/weather)
### 事前準備
* 「[OpenWeatherMap](https://openweathermap.org/price#weather)」サイトにてアカウント登録をし、APIキーの取得を行う
* app/weather/main.goのapiKeyを発行されたAPIキーに置き換える
* 使用するAPIは下記

```http request
// api call
https://api.openweathermap.org/data/2.5/forecast?q={city name}&units=metric&cnt={cnt}&appid={API key}

// response exsample
{
  "city": {
    "id": 2643743,
    "name": "London",
    "coord": {
      "lon": -0.1257,
      "lat": 51.5085
    },
    "country": "GB",
    "population": 1000000,
    "timezone": 3600
  },
  "cod": "200",
  "message": 0.0610271,
  "cnt": 7,
  "list": [
    {
      "dt": 1625140800,
      "sunrise": 1625111254,
      "sunset": 1625170853,
      "temp": {
        "day": 19.55,
        "min": 11.96,
        "max": 19.77,
        "night": 16.09,
        "eve": 19.47,
        "morn": 13.33
      },
      "feels_like": {
        "day": 19.15,
        "night": 15.43,
        "eve": 18.93,
        "morn": 12.7
      },
      "pressure": 1018,
      "humidity": 61,
      "weather": [
        {
          "id": 803,
          "main": "Clouds",
          "description": "broken clouds",
          "icon": "04d"
        }
      ],
      "speed": 2.71,
      "deg": 335,
      "gust": 3.8,
      "clouds": 69,
      "pop": 0.15
    },
    {
      "dt": 1625227200,
      "sunrise": 1625197696,
      "sunset": 1625257232,
      "temp": {
        "day": 21.51,
        "min": 14.46,
        "max": 22.73,
        "night": 16.56,
        "eve": 20.83,
        "morn": 15.21
      },
      "feels_like": {
        "day": 21.36,
        "night": 16.54,
        "eve": 20.69,
        "morn": 14.72
      },
      "pressure": 1016,
      "humidity": 63,
      "weather": [
        {
          "id": 500,
          "main": "Rain",
          "description": "light rain",
          "icon": "10d"
        }
      ],
      "speed": 4.01,
      "deg": 216,
      "gust": 6.08,
      "clouds": 58,
      "pop": 0.77,
      "rain": 2.32
    },
    {
      "dt": 1625313600,
      "sunrise": 1625284141,
      "sunset": 1625343609,
      "temp": {
        "day": 17.31,
        "min": 15.75,
        "max": 21.21,
        "night": 16.17,
        "eve": 18.97,
        "morn": 15.81
      },
      "feels_like": {
        "day": 17.34,
        "night": 16.24,
        "eve": 19.09,
        "morn": 15.56
      },
      "pressure": 1014,
      "humidity": 86,
      "weather": [
        {
          "id": 500,
          "main": "Rain",
          "description": "light rain",
          "icon": "10d"
        }
      ],
      "speed": 3.84,
      "deg": 212,
      "gust": 7.93,
      "clouds": 100,
      "pop": 0.81,
      "rain": 3.83
    },
    ........
  ]
}
                   

                  
```

### 実際に動かしてみる
#### dockerを立ち上げ
```
% docker-compose up -d
 % docker-compose ps
NAME              IMAGE           COMMAND                                                                     SERVICE    CREATED          STATUS          PORTS
go-dev-go-app-1   go-dev-go-app   "air"                                                                       go-app     26 minutes ago   Up 24 minutes   0.0.0.0:18000->8080/tcp
mysql-db          mysql:8.0.29    "docker-entrypoint.sh --init-file /docker-entrypoint-initdb.d/schema.sql"   mysql-db   26 minutes ago   Up 24 minutes   33060/tcp, 0.0.0.0:33306->3306/tcpgo-dev-go-1 exited with code 0
```
#### go-appに入ってbuildしてから実行
````shell
% docker-compose exec go-app bash
root@436b7d2f64f0:/app# cd weather/
root@436b7d2f64f0:/app/weather# go build -o weather 
go: downloading github.com/go-sql-driver/mysql v1.7.1
root@436b7d2f64f0:/app/weather# ./weather
City Name: 東京都
日付: 2023-10-16 21:00:00, 気温: 16.54
日付: 2023-10-17 00:00:00, 気温: 17.78
日付: 2023-10-17 03:00:00, 気温: 20.88
日付: 2023-10-17 06:00:00, 気温: 24.11
日付: 2023-10-17 09:00:00, 気温: 21.61
日付: 2023-10-17 12:00:00, 気温: 20.39
日付: 2023-10-17 15:00:00, 気温: 19.85
日付: 2023-10-17 18:00:00, 気温: 19.13
日付: 2023-10-17 21:00:00, 気温: 18.54
日付: 2023-10-18 00:00:00, 気温: 18.92
日付: 2023-10-18 03:00:00, 気温: 20.91
日付: 2023-10-18 06:00:00, 気温: 23.05
日付: 2023-10-18 09:00:00, 気温: 22.01
日付: 2023-10-18 12:00:00, 気温: 21.70
日付: 2023-10-18 15:00:00, 気温: 20.78
日付: 2023-10-18 18:00:00, 気温: 19.87
日付: 2023-10-18 21:00:00, 気温: 19.10
日付: 2023-10-19 00:00:00, 気温: 20.80
日付: 2023-10-19 03:00:00, 気温: 23.30
日付: 2023-10-19 06:00:00, 気温: 23.54
日付: 2023-10-19 09:00:00, 気温: 22.47
日付: 2023-10-19 12:00:00, 気温: 21.35
日付: 2023-10-19 15:00:00, 気温: 20.42
日付: 2023-10-19 18:00:00, 気温: 19.77
日付: 2023-10-19 21:00:00, 気温: 19.18
日付: 2023-10-20 00:00:00, 気温: 21.46
日付: 2023-10-20 03:00:00, 気温: 24.50
日付: 2023-10-20 06:00:00, 気温: 24.93
日付: 2023-10-20 09:00:00, 気温: 22.43
日付: 2023-10-20 12:00:00, 気温: 21.52
日付: 2023-10-20 15:00:00, 気温: 21.08
日付: 2023-10-20 18:00:00, 気温: 18.45
日付: 2023-10-20 21:00:00, 気温: 16.92
日付: 2023-10-21 00:00:00, 気温: 17.24
日付: 2023-10-21 03:00:00, 気温: 18.49
日付: 2023-10-21 06:00:00, 気温: 19.53
日付: 2023-10-21 09:00:00, 気温: 18.19
日付: 2023-10-21 12:00:00, 気温: 14.75
日付: 2023-10-21 15:00:00, 気温: 13.55
日付: 2023-10-21 18:00:00, 気温: 12.98
````
#### mysql-dbに入ってデータが登録されているか確認
```shell
% docker-compose exec mysql-db bash
bash-4.4# mysql -ugo -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 10
Server version: 8.0.29 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| playground         |
+--------------------+
2 rows in set (0.09 sec)

mysql> use playground;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+----------------------+
| Tables_in_playground |
+----------------------+
| city                 |
| city_detail          |
| city_temperature     |
+----------------------+
3 rows in set (0.02 sec)

mysql> select * from city;
+---------+---------+-----------+---------------------+---------------------+
| id      | country | name      | created_at          | updated_at          |
+---------+---------+-----------+---------------------+---------------------+
| 1850144 | JP      | 東京都    | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
+---------+---------+-----------+---------------------+---------------------+
1 row in set (0.01 sec)

mysql> select * from city_detail;
+----+---------+---------+---------+------------+----------+---------------------+---------------------+
| id | city_id | lat     | lon     | population | timezone | created_at          | updated_at          |
+----+---------+---------+---------+------------+----------+---------------------+---------------------+
|  1 | 1850144 | 35.6895 | 139.692 |   12445327 |    32400 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
+----+---------+---------+---------+------------+----------+---------------------+---------------------+
1 row in set (0.01 sec)

mysql> select * from city_temperature;
+----+---------+---------------------+-------------+----------+----------+---------------------+---------------------+
| id | city_id | date                | temperature | pressure | humidity | created_at          | updated_at          |
+----+---------+---------------------+-------------+----------+----------+---------------------+---------------------+
|  1 | 1850144 | 2023-10-16 21:00:00 |       16.54 |     1011 |       72 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  2 | 1850144 | 2023-10-17 00:00:00 |       17.78 |     1012 |       64 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  3 | 1850144 | 2023-10-17 03:00:00 |       20.88 |     1013 |       50 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  4 | 1850144 | 2023-10-17 06:00:00 |       24.11 |     1014 |       37 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  5 | 1850144 | 2023-10-17 09:00:00 |       21.61 |     1016 |       58 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  6 | 1850144 | 2023-10-17 12:00:00 |       20.39 |     1018 |       64 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  7 | 1850144 | 2023-10-17 15:00:00 |       19.85 |     1019 |       54 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  8 | 1850144 | 2023-10-17 18:00:00 |       19.13 |     1019 |       45 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
|  9 | 1850144 | 2023-10-17 21:00:00 |       18.54 |     1021 |       47 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 10 | 1850144 | 2023-10-18 00:00:00 |       18.92 |     1022 |       43 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 11 | 1850144 | 2023-10-18 03:00:00 |       20.91 |     1021 |       45 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 12 | 1850144 | 2023-10-18 06:00:00 |       23.05 |     1020 |       49 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 13 | 1850144 | 2023-10-18 09:00:00 |       22.01 |     1020 |       65 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 14 | 1850144 | 2023-10-18 12:00:00 |        21.7 |     1021 |       65 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 15 | 1850144 | 2023-10-18 15:00:00 |       20.78 |     1019 |       66 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 16 | 1850144 | 2023-10-18 18:00:00 |       19.87 |     1018 |       67 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 17 | 1850144 | 2023-10-18 21:00:00 |        19.1 |     1019 |       66 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 18 | 1850144 | 2023-10-19 00:00:00 |        20.8 |     1019 |       56 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 19 | 1850144 | 2023-10-19 03:00:00 |        23.3 |     1017 |       42 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 20 | 1850144 | 2023-10-19 06:00:00 |       23.54 |     1015 |       44 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 21 | 1850144 | 2023-10-19 09:00:00 |       22.47 |     1015 |       49 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 22 | 1850144 | 2023-10-19 12:00:00 |       21.35 |     1015 |       52 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 23 | 1850144 | 2023-10-19 15:00:00 |       20.42 |     1013 |       59 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 24 | 1850144 | 2023-10-19 18:00:00 |       19.77 |     1012 |       61 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 25 | 1850144 | 2023-10-19 21:00:00 |       19.18 |     1010 |       65 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 26 | 1850144 | 2023-10-20 00:00:00 |       21.46 |     1009 |       55 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 27 | 1850144 | 2023-10-20 03:00:00 |        24.5 |     1005 |       48 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 28 | 1850144 | 2023-10-20 06:00:00 |       24.93 |     1002 |       49 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 29 | 1850144 | 2023-10-20 09:00:00 |       22.43 |     1002 |       61 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 30 | 1850144 | 2023-10-20 12:00:00 |       21.52 |     1002 |       64 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 31 | 1850144 | 2023-10-20 15:00:00 |       21.08 |     1002 |       60 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 32 | 1850144 | 2023-10-20 18:00:00 |       18.45 |     1003 |       47 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 33 | 1850144 | 2023-10-20 21:00:00 |       16.92 |     1005 |       44 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 34 | 1850144 | 2023-10-21 00:00:00 |       17.24 |     1007 |       43 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 35 | 1850144 | 2023-10-21 03:00:00 |       18.49 |     1005 |       45 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 36 | 1850144 | 2023-10-21 06:00:00 |       19.53 |     1004 |       43 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 37 | 1850144 | 2023-10-21 09:00:00 |       18.19 |     1008 |       32 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 38 | 1850144 | 2023-10-21 12:00:00 |       14.75 |     1012 |       41 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 39 | 1850144 | 2023-10-21 15:00:00 |       13.55 |     1014 |       47 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
| 40 | 1850144 | 2023-10-21 18:00:00 |       12.98 |     1016 |       48 | 2023-10-17 06:00:34 | 2023-10-17 06:00:34 |
+----+---------+---------------------+-------------+----------+----------+---------------------+---------------------+
40 rows in set (0.01 sec)

```

